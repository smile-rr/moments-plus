---
import type { Locale } from '../i18n';
import { t, getLocalizedPath } from '../i18n';
import { getBlogPosts, formatDate } from '../utils/blog';

interface Props {
  lang: Locale;
}

const { lang } = Astro.props;
const posts = await getBlogPosts(lang);
const latestPosts = posts.slice(0, 3);

const sectionTitle = {
  en: 'Latest Stories',
  zh: '最新动态',
};

const viewAllText = {
  en: 'View All',
  zh: '查看全部',
};
---

{latestPosts.length > 0 && (
  <section class="blog-preview-section py-32 px-4 md:px-8 relative overflow-hidden">
    <div class="blog-bg"></div>
    
    <div class="max-w-6xl mx-auto relative z-10">
      <div class="flex justify-between items-end mb-16">
        <h2 class="section-title text-3xl md:text-4xl font-semibold" style="color: #1d1d1f;">
          {sectionTitle[lang]}
        </h2>
        <a 
          href={getLocalizedPath(lang, 'blog')}
          class="text-sm hover:opacity-70 transition-opacity"
          style="color: #0071e3;"
        >
          {viewAllText[lang]} →
        </a>
      </div>
      
      <div class="grid md:grid-cols-3 gap-8">
        {latestPosts.map((post, index) => (
          <a 
            href={getLocalizedPath(lang, `blog/${post.id.split('/')[1].replace(/\.md$/, '')}`)}
            class="blog-card group"
            style={`animation-delay: ${index * 0.1}s`}
          >
            <article class="bg-white rounded-2xl p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
              {post.data.category && (
                <span class="inline-block px-3 py-1 text-xs font-medium rounded-full mb-3" style="background: #f5f5f7; color: #86868b;">
                  {post.data.category}
                </span>
              )}
              <h3 class="text-xl font-semibold mb-3 group-hover:opacity-70 transition-opacity" style="color: #1d1d1f; line-height: 1.3;">
                {post.data.title}
              </h3>
              <p class="text-sm mb-4 line-clamp-2" style="color: #86868b; line-height: 1.5;">
                {post.data.description}
              </p>
              <time class="text-xs" style="color: #86868b;">
                {formatDate(post.data.publishDate, lang)}
              </time>
            </article>
          </a>
        ))}
      </div>
    </div>
  </section>
)}

<style>
  .blog-preview-section {
    background: linear-gradient(180deg, #f7f7f9 0%, #f5f5f7 100%);
  }
  
  .blog-bg {
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse 60% 40% at 70% 30%, rgba(255, 218, 185, 0.03) 0%, transparent 50%);
  }
  
  .section-title {
    animation: fadeIn 0.8s ease-out;
  }
  
  .blog-card {
    animation: fadeInUp 0.8s ease-out both;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
