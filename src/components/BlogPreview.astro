---
import type { Locale } from '../i18n';
import { t, getLocalizedPath } from '../i18n';
import { getBlogPosts, formatDate } from '../utils/blog';

interface Props {
  lang: Locale;
}

const { lang } = Astro.props;
const posts = await getBlogPosts(lang);
const latestPosts = posts.slice(0, 3);

const sectionTitle = {
  en: 'Latest Stories',
  zh: '最新动态',
  ja: '最新記事',
};

const viewAllText = {
  en: 'View All',
  zh: '查看全部',
  ja: 'すべて見る',
};
---

{latestPosts.length > 0 && (
  <section class="py-32 px-4 md:px-8" style="background: #f5f5f7;">
    <div class="max-w-6xl mx-auto">
      <div class="flex justify-between items-end mb-16">
        <h2 class="text-3xl md:text-4xl font-semibold" style="color: #1d1d1f;">
          {sectionTitle[lang]}
        </h2>
        <a 
          href={getLocalizedPath(lang, 'blog')}
          class="text-sm hover:opacity-70 transition-opacity"
          style="color: #0071e3;"
        >
          {viewAllText[lang]} →
        </a>
      </div>
      
      <div class="grid md:grid-cols-3 gap-8">
        {latestPosts.map((post) => (
          <a 
            href={getLocalizedPath(lang, `blog/${post.id.split('/')[1]}`)}
            class="group"
          >
            <article class="bg-white rounded-2xl p-6 hover:shadow-lg transition-shadow">
              {post.data.category && (
                <span class="inline-block px-3 py-1 text-xs font-medium rounded-full mb-3" style="background: #f5f5f7; color: #86868b;">
                  {post.data.category}
                </span>
              )}
              <h3 class="text-xl font-semibold mb-3 group-hover:opacity-70 transition-opacity" style="color: #1d1d1f; line-height: 1.3;">
                {post.data.title}
              </h3>
              <p class="text-sm mb-4 line-clamp-2" style="color: #86868b; line-height: 1.5;">
                {post.data.description}
              </p>
              <time class="text-xs" style="color: #86868b;">
                {formatDate(post.data.publishDate, lang)}
              </time>
            </article>
          </a>
        ))}
      </div>
    </div>
  </section>
)}

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
