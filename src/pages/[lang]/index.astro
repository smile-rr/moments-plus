---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import Features from '../../components/Features.astro';
import Screenshots from '../../components/Screenshots.astro';
import DownloadCTA from '../../components/DownloadCTA.astro';
import { SUPPORTED_LOCALES, type Locale } from '../../i18n';
import { getHomeContent } from '../../utils/content';

export async function getStaticPaths() {
  // 只为非默认语言生成路径
  return SUPPORTED_LOCALES
    .filter(lang => lang !== 'en')
    .map((lang) => ({
      params: { lang },
    }));
}

const { lang } = Astro.params as { lang: Locale };
const homeContent = await getHomeContent(lang);

if (!homeContent) {
  return Astro.redirect('/en');
}

const { data } = homeContent;
const currentPath = `/${lang}`;
---

<BaseLayout 
  title={data.title} 
  description={data.description} 
  lang={lang}
  currentPath={currentPath}
>
  <Hero
    title={data.hero.title}
    subtitle={data.hero.subtitle}
    description={data.description}
    ctaText={data.hero.ctaText}
    ctaLink={data.hero.ctaLink}
    appIcon="/images/icon/AppIconImage.png"
  />
  
  <Screenshots screenshots={data.screenshots} />
  
  <Features 
    features={data.features}
    title={data.featuresSection?.title}
    subtitle={data.featuresSection?.subtitle}
  />
  
  <DownloadCTA 
    ctaText={data.hero.ctaText}
    ctaLink={data.hero.ctaLink}
    lang={lang}
  />
</BaseLayout>
